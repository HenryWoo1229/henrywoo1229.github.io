<!DOCTYPE html>

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">

  <meta name="description" content="今天来写一个 Android monkey 全自动化模型。原因是这样的，之前给测试组写的一个 monkey 测试工具，除了执行测试外，还要周期性导出 logcat 和 trace 文件，并上传到 FTP 上便于提交 issue 后开发能直接从 FTP 下载相关的 logcat 分析。然而，因为每次测">


<link rel="alternate" href="/atom.xml" title="一个极其普通的程序员" type="application/atom+xml">
<meta name="theme-color" content="#a1d0f6">
<title>一个极其普通的程序员</title>
<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<link rel="shortcut icon" href="/favicon.png">

<link rel="stylesheet" href="/css/style.css">

<nav class="main-nav">

	
	    <a href="/">← 主页</a>
	
	
	    <a href="/about/">About</a>
	
	    <a href="/archives/">Archives</a>
	
	
	<!--
	<a class="cta" href="/atom.xml" data-no-instant>订阅</a>
	-->
</nav>

<section id="wrapper">
    <article class="post">
    <header>
        
        <h2 class="headline">May 07 2020
        
        </h2>
    </header>
</article>
<section id="post-body"><p>今天来写一个 Android monkey 全自动化模型。原因是这样的，之前给测试组写的一个 monkey 测试工具，除了执行测试外，还要周期性导出 logcat 和 trace 文件，并上传到 FTP 上便于提交 issue 后开发能直接从 FTP 下载相关的 logcat 分析。然而，因为每次测试时差不多会有十几台 Android device 运行 monkey，这样日志文件非常多，需要统计出其中的 Exception，以及 tombstone，ANR，system error，并且，还要自动去除重复的问题</p>
<p>我们当前是怎么做的呢？由每个测试人员自己运行测试，测试结束（一般是一个晚上）后，测试工具会把 log 上传到 FTP。第二天测试负责人会使用我提供的一个统计程序把所有 device 当天上传过来的日志文件进行统计并输出报告的操作，测试人员再将 issue 提交到 JIRA</p>
<p>我发现这个流程中有一些可以提高效率的地方。比如：</p>
<ul>
<li>log 文件可以直接从本地上到数据库</li>
<li>问题统计可以自动触发</li>
<li>问题可以自动提交 JIRA</li>
</ul>
<p>根据分析找到的这些需求点，设计出这样一个全自动化的模型</p>
<p><img src="http://note.youdao.com/yws/res/8513/FC2704452C0D4BD683955D95E7D64F6B" alt="image"></p>
<p>解释一下这幅图。这个模型中可以有 N 台 PC，里面的 Clinet 是 monkey 测试工具，负责跟 Android device 进行交互，比如执行测试命令，导出日志文件，存放到本地 Log dir 中。同时，该 PC 上还会部署一套 Flume 日志系统，用来监控日志目录中的新文件，并将里面的跟问题相关的核心内容 sink 到 Server 中的 HBase 下。</p>
<p>Spark 用来进行离线处理 HBase 中的问题大数据。而如何自动触发它的启动呢？这里设定的是定时任务，即每天早上 9 点，会有个脚本自动启动 Spark 去检索 HBase 中的数据做运算。当 Spark 将指定时间段内的数据运算完，就得到了一份测试结果输出到文件中。同时会请求 JIRA 上所有 monkey 关键字的问题做检索，并将重复但尚未解决的问题去掉，其他问题，自动提交到 JIRA<br> issue 中</p>
<p> 以上，就实现了一个流程上的全自动化操作。测试人员早上过来上班，就能立即看到测试结果，而 JIRA 也会分发问题给各开发负责人了</p>
</section>
    


  <section id="comment">
    <button class="btn" id="loadcmts" onclick="cmts.load();">加载评论</button>
    <div id="gitment"></div>
    <script src='/js/gitment.browser.js'></script>
    <link rel="stylesheet" href=''>
    <script>
      var cmts={
        load:function cmts(){
          var gitment = new Gitment({
          
            owner: "",
            repo: "",
            oauth: {
              client_id: "",
              client_secret: "",
            },
          })
          gitment.render('gitment');
          var loadcmt = document.getElementById("loadcmts");
          var imyourfather = loadcmt.parentNode;
          imyourfather.removeChild(loadcmts)
        }
      }
    </script>
  </section>


	<footer id="footer">
	<div id="social">
		<p class="small">©  Henry Woo in CHJ Inc.
		</p>
	</div>
</footer>

</section>

	<script src="//cdnjs.loli.net/ajax/libs/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
	<script data-no-instant>
		
		InstantClick.init('mousedown');
	</script>



